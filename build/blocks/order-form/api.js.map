{"version":3,"file":"blocks/order-form/api.js","mappings":"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","sources":["webpack://@wp-mos/blocks/./src/blocks/order-form/api.js"],"sourcesContent":["document.addEventListener(\"DOMContentLoaded\", () => {\n  // TODO check valid\n  let totalPrice = null\n  let customer = []\n  let filesData = []\n  let lastWrapperId = 0\n  let totalPriceElm = null\n\n  const loader = '…'\n  const formGroup = document.querySelector('.form-group');\n  const apiUrl = 'https://lasercut.internetguru.io/api/v2/analyze?id=mos';\n\n  function addFileGroupListener(formGroup, fileGroupId) {\n    formGroup.addEventListener('change', (event) => {\n      calculatePrice(fileGroupId)\n    })\n    formGroup.querySelector(\".form-quantity\").addEventListener('keydown', (event) => {\n      if (event.key === 'Enter') {\n        calculatePrice(fileGroupId)\n        event.preventDefault()\n      }\n      if (event.keyCode == 9) {\n        calculatePrice(fileGroupId)\n      }\n    })\n  }\n\n  function addFileWrapper(formGroup, fileGroupId) {\n    let newWrapper = formGroup.cloneNode(true)\n    lastWrapperId++\n    initFilesData(lastWrapperId, newWrapper)\n    newWrapper.setAttribute('data-filenum', lastWrapperId)\n    newWrapper.querySelector('.form-filestatus').innerHTML = '–'\n    newWrapper.querySelector(\".form-file\").value = ''\n    newWrapper.querySelector(\".form-quantity\").value = 1\n    newWrapper.querySelector(\".form-size\").innerHTML = '–'\n    // newWrapper.querySelector('.form-fileid').innerHTML = '–'\n    formGroup.querySelector('.form-wrapper').insertAdjacentHTML('beforeend', `<a class=\"form-del btn btn-outline-dark border-0 w-auto mt-0 position-absolute top-0 end-0\" data-id=\"${fileGroupId}\" href=\"Javascript:void(0);\"><span class=\"bi-x-lg\"></span></a>`)\n    formGroup.querySelector('.form-filestatus').insertAdjacentHTML('afterend', `<div><div></div><a class=\"form-calc btn btn-primary btn-sm\" title=\"Recalculate\" href=\"Javascript:void(0);\"><span class=\"bi-arrow-clockwise fs-5\"></span></a></div>`)\n    fileInput = formGroup.querySelector(\".form-file\")\n    fileName = document.createElement('p')\n    fileName.className = \"mt-2 mb-0\"\n    fileName.innerHTML = fileInput.files[0].name\n    fileInput.parentNode.replaceChild(fileName, fileInput)\n    formGroup.querySelector('.form-del').addEventListener('click', (event) => {\n      filesData[event.currentTarget.getAttribute('data-id')] = null\n      formGroup.parentNode.removeChild(formGroup)\n      updateForm()\n    })\n    formGroup.querySelector(\".form-calc\").addEventListener('click', (event) => {\n      calculatePrice(fileGroupId)\n    })\n    addFileGroupListener(newWrapper, lastWrapperId)\n    formGroup.parentNode.insertBefore(newWrapper, formGroup.nextElementSibling)\n  }\n\n  function initFilesData(formGroupId, formGroup) {\n    filesData[formGroupId] = {\n      formGroup: formGroup,\n      status: null,\n      lastMod: null,\n      material: null,\n      quantity: null,\n      file: null,\n      fileHash: null,\n      fileURL: null,\n      fileWidth: null,\n      fileHeight: null,\n      productPrice: null,\n      addedWrapper: false,\n      valid: false,\n    }\n  }\n\n  function formatPrice(num) {\n    return num.toLocaleString('cs-CZ')\n  }\n\n  function formatSize(num) {\n    return Math.round(num);\n    //return num.replace(/\\..*$/, '')\n  }\n\n  function updateForm(fileGroupId) {\n    totalPrice = 0\n    filesData.forEach((file) => {\n      if (file == null || file.prices == null) {\n        return\n      }\n      if (fileGroupId !== undefined && fileGroupId == file.formGroup.getAttribute('data-filenum')) {\n        file.status.innerHTML = loader\n      }\n      var materialSelect = file.formGroup.querySelector('.form-material')\n      if (materialSelect.children.length == 1) {\n        materialSelect.innerHTML = ''\n        file.prices.forEach((priceData) => {\n          var option = document.createElement('option')\n          option.value = priceData.material_id\n          option.innerHTML = `${priceData.material_name}`\n          option.setAttribute('data-name', priceData.material_name)\n          materialSelect.appendChild(option)\n        })\n      }\n      var quantity = file.formGroup.querySelector('.form-quantity').value\n      var price = file.prices[materialSelect.selectedIndex].unit_price\n        * quantity + file.prices[materialSelect.selectedIndex].fix_price\n      setTimeout(() => {\n        file.status.innerHTML = `${formatPrice(price)} €`\n      }, 400)\n      width = formatSize(file.fileWidth)\n      height = formatSize(file.fileHeight)\n      file.formGroup.querySelector('.form-size').innerHTML = `${width} × ${height}`\n      file.productPrice = price\n      totalPrice += price\n      file.material = materialSelect[materialSelect.selectedIndex].getAttribute('data-name')\n    })\n    totalPriceElm.innerHTML = `${formatPrice(totalPrice)} €`\n  }\n\n  function getValidFilesCnt() {\n    cnt = 0\n    filesData.forEach((file) => {\n      if (file == null) {\n        return\n      }\n      if (!file.valid) {\n        return\n      }\n      cnt++\n    })\n    return cnt\n  }\n\n  function calculatePrice(fileGroupId) {\n    const formGroup = filesData[fileGroupId].formGroup\n    const fileInputElement = formGroup.querySelector(\".form-file\")\n    const material = formGroup.querySelector(\".form-material\").value\n    const materialName = formGroup.querySelector(\".form-material\").selectedOptions[0].text\n    const quantity = formGroup.querySelector(\".form-quantity\").value\n    const status = formGroup.querySelector('.form-filestatus')\n    let file = null\n    if (filesData[fileGroupId].file == null) {\n      if (!fileInputElement.value) {\n        status.innerHTML = 'Choose file'\n        return false\n      }\n      file = fileInputElement.files[0]\n    } else {\n      file = filesData[fileGroupId].file\n    }\n    if (quantity < 1 || quantity > 100) {\n      status.innerHTML = 'Quantity must be between 1 and 100'\n      return false\n    }\n    const fileName = file.name\n    const lastMod = file.lastModified + fileName\n    filesData[fileGroupId].quantity = quantity\n    if (filesData[fileGroupId].lastMod !== lastMod) {\n      filesData[fileGroupId].status = status\n      filesData[fileGroupId].material = materialName\n      filesData[fileGroupId].lastMod = lastMod\n      var form = new FormData()\n      form.append(\"material\", material)\n      form.append(\"amount\", quantity)\n      if (filesData[fileGroupId].valid && filesData[fileGroupId].fileHash !== null) {\n        form.append(\"hash\", filesData[fileGroupId].fileHash)\n      } else {\n        form.append(\"dxf_file\", file, fileName)\n      }\n      status.innerHTML = loader\n      fetch(apiUrl, {\n        method: 'post',\n        body: form\n      })\n        .then((response) => {\n          if (response.ok) {\n            return response.json();\n          }\n          return response.json().then(text => {\n            throw new Error(text.message)\n          })\n        })\n        .then((result) => {\n          filesData[fileGroupId].prices = result.prices\n          filesData[fileGroupId].materialPrices = result.prices\n          filesData[fileGroupId].fileHash = result.file_hash\n          filesData[fileGroupId].fileURL = result.filew_path\n          filesData[fileGroupId].fileWidth = result.model_width\n          filesData[fileGroupId].fileHeight = result.model_height\n          filesData[fileGroupId].file = file\n          filesData[fileGroupId].valid = true\n          if (!filesData[fileGroupId].addedWrapper) {\n            addFileWrapper(formGroup, fileGroupId)\n            filesData[fileGroupId].addedWrapper = true\n          }\n          updateForm(fileGroupId)\n        })\n        .catch((error) => {\n          alert(error)\n          status.innerHTML = '–'\n          filesData[fileGroupId].lastMod = null\n          filesData[fileGroupId].valid = false\n        })\n      return\n    }\n    filesData[fileGroupId].material = quantity\n    filesData[fileGroupId].material = materialName\n    updateForm(fileGroupId)\n    filesData[fileGroupId].valid = true\n  }\n  \n  initFilesData(0, formGroup)\n  totalPriceElm = document.getElementById(\"order-price\")\n  addFileGroupListener(formGroup, 0)\n  formGroup.addEventListener('submit', (event) => {\n    event.preventDefault()\n    if (getValidFilesCnt() == 0) {\n      // TODO highlight error\n      return false\n    }\n    var msg = document.querySelector('.status-message')\n    if (msg) {\n      msg.parentNode.removeChild(msg)\n    }\n  })\n  document.querySelector('.form-placeholder').style.display = 'none';\n  document.querySelector('.form-placeholder + form').style.display = 'block';\n});"],"names":["document","addEventListener","totalPrice","customer","filesData","lastWrapperId","totalPriceElm","loader","formGroup","querySelector","apiUrl","addFileGroupListener","fileGroupId","event","calculatePrice","key","preventDefault","keyCode","addFileWrapper","newWrapper","cloneNode","initFilesData","setAttribute","innerHTML","value","insertAdjacentHTML","fileInput","fileName","createElement","className","files","name","parentNode","replaceChild","currentTarget","getAttribute","removeChild","updateForm","insertBefore","nextElementSibling","formGroupId","status","lastMod","material","quantity","file","fileHash","fileURL","fileWidth","fileHeight","productPrice","addedWrapper","valid","formatPrice","num","toLocaleString","formatSize","Math","round","forEach","prices","undefined","materialSelect","children","length","priceData","option","material_id","material_name","appendChild","price","selectedIndex","unit_price","fix_price","setTimeout","width","height","getValidFilesCnt","cnt","fileInputElement","materialName","selectedOptions","text","lastModified","form","FormData","append","fetch","method","body","then","response","ok","json","Error","message","result","materialPrices","file_hash","filew_path","model_width","model_height","catch","error","alert","getElementById","msg","style","display"],"sourceRoot":""}