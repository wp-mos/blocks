{"version":3,"file":"blocks/formular-comanda/api.js","mappings":"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","sources":["webpack://@wp-mos/blocks/./src/blocks/formular-comanda/api.js"],"sourcesContent":["document.addEventListener(\"DOMContentLoaded\", () => {\n  let totalPrice = null;\n  let filesData = [];\n  let lastWrapperId = 0;\n  let totalPriceElm = null;\n\n  const orderForm = document.getElementById(\"mos-order-form\");\n\n  function addFileWrapperListener(fileWrapper, wrapId) {\n    fileWrapper.addEventListener(\"change\", (event) => {\n      calculatePrice(wrapId);\n    });\n    fileWrapper\n      .querySelector(\".form-quantity\")\n      .addEventListener(\"keydown\", (event) => {\n        if (event.key === \"Enter\") {\n          calculatePrice(wrapId);\n          event.preventDefault();\n        }\n        if (event.keyCode == 9) {\n          calculatePrice(wrapId);\n        }\n      });\n  }\n\n  function addFileWrapper(fileWrapper, wrapId) {\n    let newWrapper = fileWrapper.cloneNode(true);\n    lastWrapperId++;\n    initFilesData(lastWrapperId, newWrapper);\n    newWrapper.setAttribute(\"data-filenum\", lastWrapperId);\n    newWrapper.querySelector(\".form-file-status\").innerHTML = \"-\";\n    newWrapper.querySelector(\".form-file\").value = \"\";\n    newWrapper.querySelector(\".form-quantity\").value = 1;\n    newWrapper.querySelector(\".form-size\").innerHTML = \"-\";\n    fileWrapper\n      .querySelector(\".col\")\n      .insertAdjacentHTML(\n        \"beforeend\",\n        `<a class=\"form-del btn btn-outline-dark border-0 w-auto mt-0 position-absolute top-0 end-0\" data-id=\"${wrapId}\" href=\"Javascript:void(0);\"><span class=\"bi-x-lg\"></span></a>`\n      );\n    fileWrapper\n      .querySelector(\".form-file-status\")\n      .insertAdjacentHTML(\n        \"afterend\",\n        `<div><div></div><a class=\"form-calc btn btn-primary btn-sm\" title=\"Recalculate\" href=\"Javascript:void(0);\"><span class=\"bi-arrow-clockwise fs-5\"></span></a></div>`\n      );\n    let fileInput = fileWrapper.querySelector(\".form-file\");\n    let fileName = document.createElement(\"p\");\n    fileName.className = \"mt-2 mb-0\";\n    fileName.innerHTML = fileInput.files[0].name;\n    fileInput.parentNode.replaceChild(fileName, fileInput);\n    fileWrapper\n      .querySelector(\".form-del\")\n      .addEventListener(\"click\", (event) => {\n        filesData[event.currentTarget.getAttribute(\"data-id\")] = null;\n        fileWrapper.parentNode.removeChild(fileWrapper);\n        updateForm();\n      });\n    fileWrapper\n      .querySelector(\".form-calc\")\n      .addEventListener(\"click\", (event) => {\n        calculatePrice(wrapId);\n      });\n    addFileWrapperListener(newWrapper, lastWrapperId);\n    fileWrapper.parentNode.insertBefore(\n      newWrapper,\n      fileWrapper.nextElementSibling\n    );\n  }\n\n  function initFilesData(wrapperId, wrapperElm) {\n    filesData[wrapperId] = {\n      fileWrapper: wrapperElm,\n      status: null,\n      lastMod: null,\n      material: null,\n      quantity: null,\n      file: null,\n      fileHash: null,\n      fileURL: null,\n      fileWidth: null,\n      fileHeight: null,\n      productPrice: null,\n      addedWrapper: false,\n      valid: false,\n    };\n  }\n\n  function formatPrice(num) {\n    return num.toLocaleString();\n  }\n\n  function formatSize(num) {\n    return Math.round(num);\n  }\n\n  function updateForm(wrapId) {\n    totalPrice = 0;\n    filesData.forEach((file) => {\n      if (file == null || file.prices == null) {\n        return;\n      }\n      if (\n        wrapId !== undefined &&\n        wrapId == file.fileWrapper.getAttribute(\"data-filenum\")\n      ) {\n        file.status.innerHTML = loader;\n      }\n      const materialSelect = file.fileWrapper.querySelector(\".form-material\");\n      if (materialSelect.children.length == 1) {\n        materialSelect.innerHTML = \"\";\n        file.prices.forEach((priceData) => {\n          var option = document.createElement(\"option\");\n          option.value = priceData.material_id;\n          option.innerHTML = `${priceData.material_name}`;\n          option.setAttribute(\"data-name\", priceData.material_name);\n          materialSelect.appendChild(option);\n        });\n      }\n      const quantity = file.fileWrapper.querySelector(\".form-quantity\").value;\n      const price =\n        file.prices[materialSelect.selectedIndex].unit_price * quantity +\n        file.prices[materialSelect.selectedIndex].fix_price;\n      setTimeout(() => {\n        file.status.innerHTML = `${formatPrice(price)} RON`;\n      }, 400);\n      let width = formatSize(file.fileWidth);\n      let height = formatSize(file.fileHeight);\n      file.fileWrapper.querySelector(\n        \".form-size\"\n      ).innerHTML = `${width} x ${height}`;\n      file.productPrice = price;\n      totalPrice += price;\n      file.material =\n        materialSelect[materialSelect.selectedIndex].getAttribute(\"data-name\");\n    });\n    totalPriceElm.innerHTML = `${formatPrice(totalPrice)} RON`;\n  }\n\n  function getValidFilesCnt() {\n    let cnt = 0;\n    filesData.forEach((file) => {\n      if (file == null) {\n        return;\n      }\n      if (!file.valid) {\n        return;\n      }\n      cnt++;\n    });\n    return cnt;\n  }\n\n  function calculatePrice(wrapId) {\n    const fileWrapper = filesData[wrapId].fileWrapper;\n    const fileInputElement = fileWrapper.querySelector(\".form-file\");\n    const material = fileWrapper.querySelector(\".form-material\").value;\n    const materialName =\n      fileWrapper.querySelector(\".form-material\").selectedOptions[0].text;\n    const quantity = fileWrapper.querySelector(\".form-quantity\").value;\n    const status = fileWrapper.querySelector(\".form-file-status\");\n    let file = null;\n    if (filesData[wrapId].file == null) {\n      if (!fileInputElement.value) {\n        status.innerHTML = \"Choose file\";\n        return false;\n      }\n      file = fileInputElement.files[0];\n    } else {\n      file = filesData[wrapId].file;\n    }\n    if (quantity < 1 || quantity > 100) {\n      status.innerHTML = \"Quantity must be between 1 and 100\";\n      return false;\n    }\n    const fileName = file.name;\n    const lastMod = file.lastModified + fileName;\n    filesData[wrapId].quantity = quantity;\n    if (filesData[wrapId].lastMod !== lastMod) {\n      filesData[wrapId].status = status;\n      filesData[wrapId].material = materialName;\n      filesData[wrapId].lastMod = lastMod;\n      const form = new FormData();\n      form.append(\"material\", material);\n      form.append(\"amount\", quantity);\n      if (filesData[wrapId].valid && filesData[wrapId].fileHash !== null) {\n        form.append(\"hash\", filesData[wrapId].fileHash);\n      } else {\n        form.append(\"dxf_file\", file, fileName);\n      }\n      status.innerHTML = loader;\n      fetch(apiUrl, {\n        method: \"post\",\n        body: form,\n      })\n        .then((response) => {\n          if (response.ok) {\n            return response.json();\n          }\n          return response.json().then((text) => {\n            throw new Error(text.message);\n          });\n        })\n        .then((result) => {\n          // filesData[wrapId].productPrice = parseInt(result.price)\n          filesData[wrapId].prices = result.prices;\n          filesData[wrapId].materialPrices = result.prices;\n          filesData[wrapId].fileHash = result.file_hash;\n          filesData[wrapId].fileURL = result.filew_path;\n          filesData[wrapId].fileWidth = result.model_width;\n          filesData[wrapId].fileHeight = result.model_height;\n          filesData[wrapId].file = file;\n          filesData[wrapId].valid = true;\n          // if (!filesData[wrapId].addedWrapper) {\n          // addFileWrapper(fileWrapper, wrapId);\n          // filesData[wrapId].addedWrapper = true;\n          // }\n          updateForm(wrapId);\n        })\n        .catch((error) => {\n          alert(error);\n          status.innerHTML = \"-\";\n          filesData[wrapId].lastMod = null;\n          filesData[wrapId].valid = false;\n        });\n      return;\n    }\n    filesData[wrapId].material = quantity;\n    filesData[wrapId].material = materialName;\n    updateForm(wrapId);\n    filesData[wrapId].valid = true;\n  }\n\n  const loader = \"...\";\n  const fileWrapper = document.querySelector(\".form-group\");\n  const apiUrl = \"https://lasercut.internetguru.io/api/v2/analyze?id=mos\";\n\n  initFilesData(0, fileWrapper);\n  totalPriceElm = document.getElementById(\"order-price\");\n  addFileWrapperListener(fileWrapper, 0);\n\n  const handleSubmit = (event) => {\n    event.preventDefault();\n\n    const formData = new FormData(orderForm);\n\n    filesData.forEach((data) => {\n      formData.append(\"price\", data.productPrice);\n    });\n\n    const request = new XMLHttpRequest();\n    request.open(\"POST\", mos_auth_rest.order, true);\n    request.onload = () => {\n      if (request.status === 200) {\n        const response = JSON.parse(request.responseText);\n        console.log(response);\n      } else {\n        console.log(\"error\");\n      }\n    };\n    request.send(formData);\n\n    event.preventDefault();\n  };\n\n  orderForm.addEventListener(\"submit\", handleSubmit);\n\n  orderForm.reset();\n});\n"],"names":["document","addEventListener","totalPrice","filesData","lastWrapperId","totalPriceElm","orderForm","getElementById","addFileWrapperListener","fileWrapper","wrapId","event","calculatePrice","querySelector","key","preventDefault","keyCode","addFileWrapper","newWrapper","cloneNode","initFilesData","setAttribute","innerHTML","value","insertAdjacentHTML","fileInput","fileName","createElement","className","files","name","parentNode","replaceChild","currentTarget","getAttribute","removeChild","updateForm","insertBefore","nextElementSibling","wrapperId","wrapperElm","status","lastMod","material","quantity","file","fileHash","fileURL","fileWidth","fileHeight","productPrice","addedWrapper","valid","formatPrice","num","toLocaleString","formatSize","Math","round","forEach","prices","undefined","loader","materialSelect","children","length","priceData","option","material_id","material_name","appendChild","price","selectedIndex","unit_price","fix_price","setTimeout","width","height","getValidFilesCnt","cnt","fileInputElement","materialName","selectedOptions","text","lastModified","form","FormData","append","fetch","apiUrl","method","body","then","response","ok","json","Error","message","result","materialPrices","file_hash","filew_path","model_width","model_height","catch","error","alert","handleSubmit","formData","data","request","XMLHttpRequest","open","mos_auth_rest","order","onload","JSON","parse","responseText","console","log","send","reset"],"sourceRoot":""}