{"version":3,"file":"blocks/formular-comanda/api.js","mappings":";;;;;AAAAA,QAAQ,CAACC,gBAAgB,CAAC,kBAAkB,EAAE,MAAM;EAClD,MAAMC,MAAM,GAAG,wDAAwD;EAEvE,MAAMC,SAAS,GAAGH,QAAQ,CAACI,cAAc,CAAC,gBAAgB,CAAC;EAC3D,MAAMC,SAAS,GAAGL,QAAQ,CAACM,aAAa,CAAC,mBAAmB,CAAC;EAC7D,MAAMC,aAAa,GAAGP,QAAQ,CAACI,cAAc,CAAC,wBAAwB,CAAC;EAEvE,MAAMI,IAAI,GAAG,EAAE;EACf,MAAMC,MAAM,GAAG,KAAK;EAEpB,IAAIC,UAAU,GAAG,IAAI;;EAErB;EACA,MAAMC,QAAQ,GAAG,CAACC,EAAE,EAAEC,KAAK,KAAK;IAC9BL,IAAI,CAACI,EAAE,CAAC,GAAG;MACTC,KAAK,EAAEA,KAAK;MACZC,MAAM,EAAE,IAAI;MACZC,KAAK,EAAE,IAAI;MACXC,OAAO,EAAE,IAAI;MACbC,QAAQ,EAAE,IAAI;MACdC,QAAQ,EAAE,IAAI;MACdC,IAAI,EAAE,IAAI;MACVC,QAAQ,EAAE,IAAI;MACdC,OAAO,EAAE,IAAI;MACbC,SAAS,EAAE,IAAI;MACfC,UAAU,EAAE,IAAI;MAChBC,YAAY,EAAE,IAAI;MAClBC,UAAU,EAAE,KAAK;MACjBC,KAAK,EAAE;IACT,CAAC;EACH,CAAC;;EAED;EACA,MAAMC,iBAAiB,GAAG,CAACd,KAAK,EAAED,EAAE,KAAK;IACvCC,KAAK,CAACZ,gBAAgB,CAAC,QAAQ,EAAE,MAAM;MACrC2B,SAAS,CAAChB,EAAE,CAAC;IACf,CAAC,CAAC;EACJ,CAAC;EAED,MAAMiB,WAAW,GAAIjB,EAAE,IAAK;IAC1BF,UAAU,GAAG,CAAC;IACdF,IAAI,CAACsB,OAAO,CAAEjB,KAAK,IAAK;MACtB,IAAIA,KAAK,KAAK,IAAI,IAAIA,KAAK,CAACkB,MAAM,KAAK,IAAI,EAAE;QAC3C;MACF;MAEA,IAAInB,EAAE,IAAIA,EAAE,KAAKC,KAAK,CAACA,KAAK,CAACmB,YAAY,CAAC,SAAS,CAAC,EAAE;QACpDnB,KAAK,CAACC,MAAM,CAACmB,SAAS,GAAGxB,MAAM;MACjC;MAEA,MAAMyB,cAAc,GAAGrB,KAAK,CAACA,KAAK,CAACP,aAAa,CAAC,sBAAsB,CAAC;MAExE,IAAI4B,cAAc,CAACC,QAAQ,CAACC,MAAM,IAAI,CAAC,EAAE;QACvCF,cAAc,CAACD,SAAS,GAAG,EAAE;QAE7BpB,KAAK,CAACkB,MAAM,CAACD,OAAO,CAAEO,SAAS,IAAK;UAClC,MAAMC,MAAM,GAAGtC,QAAQ,CAACuC,aAAa,CAAC,QAAQ,CAAC;UAC/CD,MAAM,CAACE,KAAK,GAAGH,SAAS,CAACI,WAAW;UACpCH,MAAM,CAACL,SAAS,GAAI,GAAEI,SAAS,CAACK,aAAc,EAAC;UAC/CJ,MAAM,CAACK,YAAY,CAAC,WAAW,EAAEN,SAAS,CAACK,aAAa,CAAC;UACzDR,cAAc,CAACU,WAAW,CAACN,MAAM,CAAC;QACpC,CAAC,CAAC;MACJ;MAEA,MAAMpB,QAAQ,GAAGL,KAAK,CAACA,KAAK,CAACP,aAAa,CAAC,sBAAsB,CAAC,CAACkC,KAAK;MACxE,MAAMzB,KAAK,GACTF,KAAK,CAACkB,MAAM,CAACG,cAAc,CAACW,aAAa,CAAC,CAACC,UAAU,GAAG5B,QAAQ,GAChEL,KAAK,CAACkB,MAAM,CAACG,cAAc,CAACW,aAAa,CAAC,CAACE,SAAS;MAEtDC,UAAU,CAAC,MAAM;QACfnC,KAAK,CAACC,MAAM,CAACmB,SAAS,GAAI,GAAEgB,IAAI,CAACC,KAAK,CAACnC,KAAK,CAAE,MAAK;MACrD,CAAC,EAAE,GAAG,CAAC;MAEP,IAAIoC,KAAK,GAAGF,IAAI,CAACC,KAAK,CAACrC,KAAK,CAACS,SAAS,CAAC;MACvC,IAAI8B,MAAM,GAAGH,IAAI,CAACC,KAAK,CAACrC,KAAK,CAACU,UAAU,CAAC;MAEzCV,KAAK,CAACA,KAAK,CAACP,aAAa,CACvB,wBAAwB,CACzB,CAAC2B,SAAS,GAAI,GAAEkB,KAAM,MAAKC,MAAO,KAAI;MAEvCvC,KAAK,CAACA,KAAK,CAACW,YAAY,GAAGT,KAAK;MAChCL,UAAU,IAAIK,KAAK;MACnBF,KAAK,CAACI,QAAQ,GACZiB,cAAc,CAACA,cAAc,CAACW,aAAa,CAAC,CAACb,YAAY,CAAC,WAAW,CAAC;IAC1E,CAAC,CAAC;IACFzB,aAAa,CAAC0B,SAAS,GAAI,GAAEgB,IAAI,CAACC,KAAK,CAACxC,UAAU,CAAE,MAAK;EAC3D,CAAC;;EAED;EACA,MAAMkB,SAAS,GAAIhB,EAAE,IAAK;IACxB,MAAMC,KAAK,GAAGL,IAAI,CAACI,EAAE,CAAC,CAACC,KAAK;IAC5B,MAAMwC,SAAS,GAAGxC,KAAK,CAACP,aAAa,CAAC,kBAAkB,CAAC;IACzD,MAAMgD,aAAa,GAAGzC,KAAK,CAACP,aAAa,CAAC,sBAAsB,CAAC;IACjE,MAAMiD,aAAa,GAAG1C,KAAK,CAACP,aAAa,CAAC,sBAAsB,CAAC;IACjE,MAAMkD,UAAU,GAAG3C,KAAK,CAACP,aAAa,CAAC,oBAAoB,CAAC;;IAE5D;IACA,MAAMmD,kBAAkB,GAAGH,aAAa,CAACd,KAAK;IAC9C,MAAMkB,kBAAkB,GAAGH,aAAa,CAACf,KAAK;;IAE9C;IACA,MAAMmB,iBAAiB,GACrBL,aAAa,CAACM,OAAO,CAACN,aAAa,CAACT,aAAa,CAAC,CAACgB,IAAI;;IAEzD;IACA,IAAI1C,IAAI,GAAG,IAAI;IACf,IAAIX,IAAI,CAACI,EAAE,CAAC,CAACO,IAAI,IAAI,IAAI,EAAE;MACzB,IAAI,CAACkC,SAAS,CAACb,KAAK,EAAE;QACpBgB,UAAU,CAACvB,SAAS,GAAG,mBAAmB;QAC1C;MACF;MACAd,IAAI,GAAGkC,SAAS,CAACS,KAAK,CAAC,CAAC,CAAC;IAC3B,CAAC,MAAM;MACL3C,IAAI,GAAGX,IAAI,CAACI,EAAE,CAAC,CAACO,IAAI;IACtB;;IAEA;IACA,IAAIuC,kBAAkB,GAAG,CAAC,IAAIA,kBAAkB,GAAG,GAAG,EAAE;MACtDF,UAAU,CAACvB,SAAS,GAAG,qCAAqC;MAC5D;IACF;IAEA,MAAM8B,QAAQ,GAAG5C,IAAI,CAAC6C,IAAI;IAC1B,MAAMhD,OAAO,GAAGG,IAAI,CAAC8C,YAAY,GAAGF,QAAQ;;IAE5C;IACAvD,IAAI,CAACI,EAAE,CAAC,CAACM,QAAQ,GAAGwC,kBAAkB;IAEtC,IAAIlD,IAAI,CAACI,EAAE,CAAC,CAACI,OAAO,KAAKA,OAAO,EAAE;MAChCR,IAAI,CAACI,EAAE,CAAC,CAACE,MAAM,GAAG0C,UAAU;MAC5BhD,IAAI,CAACI,EAAE,CAAC,CAACK,QAAQ,GAAGwC,kBAAkB;MACtCjD,IAAI,CAACI,EAAE,CAAC,CAACI,OAAO,GAAGA,OAAO;MAE1B,MAAMkD,IAAI,GAAG,IAAIC,QAAQ,EAAE;MAC3BD,IAAI,CAACE,MAAM,CAAC,UAAU,EAAEX,kBAAkB,CAAC;MAC3CS,IAAI,CAACE,MAAM,CAAC,QAAQ,EAAEV,kBAAkB,CAAC;MAEzC,IAAIlD,IAAI,CAACI,EAAE,CAAC,CAACc,KAAK,IAAIlB,IAAI,CAACI,EAAE,CAAC,CAACQ,QAAQ,KAAK,IAAI,EAAE;QAChD8C,IAAI,CAACE,MAAM,CAAC,MAAM,EAAE5D,IAAI,CAACI,EAAE,CAAC,CAACQ,QAAQ,CAAC;MACxC,CAAC,MAAM;QACL8C,IAAI,CAACE,MAAM,CAAC,UAAU,EAAEjD,IAAI,EAAE4C,QAAQ,CAAC;MACzC;MAEAP,UAAU,CAACvB,SAAS,GAAGxB,MAAM;MAE7B4D,KAAK,CAACnE,MAAM,EAAE;QACZoE,MAAM,EAAE,MAAM;QACdC,IAAI,EAAEL;MACR,CAAC,CAAC,CACCM,IAAI,CAAEC,QAAQ,IAAK;QAClB,IAAIA,QAAQ,CAACC,EAAE,EAAE;UACf,OAAOD,QAAQ,CAACE,IAAI,EAAE;QACxB;QACA,OAAOF,QAAQ,CAACE,IAAI,EAAE,CAACH,IAAI,CAAEX,IAAI,IAAK;UACpC,MAAM,IAAIe,KAAK,CAACf,IAAI,CAACgB,OAAO,CAAC;QAC/B,CAAC,CAAC;MACJ,CAAC,CAAC,CACDL,IAAI,CAAEM,MAAM,IAAK;QAChBtE,IAAI,CAACI,EAAE,CAAC,CAACmB,MAAM,GAAG+C,MAAM,CAAC/C,MAAM;QAC/BvB,IAAI,CAACI,EAAE,CAAC,CAACmE,cAAc,GAAGD,MAAM,CAAC/C,MAAM;QACvCvB,IAAI,CAACI,EAAE,CAAC,CAACQ,QAAQ,GAAG0D,MAAM,CAACE,SAAS;QACpCxE,IAAI,CAACI,EAAE,CAAC,CAACS,OAAO,GAAGyD,MAAM,CAACG,SAAS;QACnCzE,IAAI,CAACI,EAAE,CAAC,CAACU,SAAS,GAAGwD,MAAM,CAACI,WAAW;QACvC1E,IAAI,CAACI,EAAE,CAAC,CAACW,UAAU,GAAGuD,MAAM,CAACK,YAAY;QACzC3E,IAAI,CAACI,EAAE,CAAC,CAACO,IAAI,GAAGA,IAAI;QACpBX,IAAI,CAACI,EAAE,CAAC,CAACc,KAAK,GAAG,IAAI;QACrB,IAAI,CAAClB,IAAI,CAACI,EAAE,CAAC,CAACC,KAAK,EAAE;UACnB;UACAL,IAAI,CAACI,EAAE,CAAC,CAACa,UAAU,GAAG,IAAI;QAC5B;QACAI,WAAW,CAACjB,EAAE,CAAC;MACjB,CAAC,CAAC,CACDwE,KAAK,CAAEC,KAAK,IAAK;QAChBC,OAAO,CAACC,GAAG,CAACF,KAAK,CAAC;QAClB7B,UAAU,CAACvB,SAAS,GAAGoD,KAAK;QAC5B7E,IAAI,CAACI,EAAE,CAAC,CAACI,OAAO,GAAG,IAAI;QACvBR,IAAI,CAACI,EAAE,CAAC,CAACc,KAAK,GAAG,KAAK;MACxB,CAAC,CAAC;MACJ;IACF;IAEAlB,IAAI,CAACI,EAAE,CAAC,CAACK,QAAQ,GAAGwC,kBAAkB;IACtC5B,WAAW,CAACjB,EAAE,CAAC;IACfJ,IAAI,CAACI,EAAE,CAAC,CAACc,KAAK,GAAG,IAAI;EACvB,CAAC;EAED,MAAM8D,IAAI,GAAG,MAAM;IACjB7E,QAAQ,CAAC,CAAC,EAAEN,SAAS,CAAC;IACtBsB,iBAAiB,CAACtB,SAAS,EAAE,CAAC,CAAC;EACjC,CAAC;EAEDmF,IAAI,EAAE;;EAEN;EACArF,SAAS,CAACF,gBAAgB,CAAC,QAAQ,EAAGwF,KAAK,IAAK;IAC9C,MAAMC,QAAQ,GAAG,IAAIvB,QAAQ,CAAChE,SAAS,CAAC;IAExC,MAAMwF,OAAO,GAAG,IAAIC,cAAc,EAAE;IACpCD,OAAO,CAACE,IAAI,CAAC,MAAM,EAAEC,aAAa,CAACC,KAAK,EAAE,IAAI,CAAC;IAC/CJ,OAAO,CAACK,MAAM,GAAG,MAAM;MACrB,IAAIL,OAAO,CAAC7E,MAAM,KAAK,GAAG,EAAE;QAC1B,MAAM2D,QAAQ,GAAGwB,IAAI,CAACC,KAAK,CAACP,OAAO,CAACQ,YAAY,CAAC;QACjDb,OAAO,CAACC,GAAG,CAACd,QAAQ,CAAC;MACvB,CAAC,MAAM;QACLa,OAAO,CAACC,GAAG,CAAC,OAAO,CAAC;MACtB;IACF,CAAC;IACDI,OAAO,CAACS,IAAI,CAACV,QAAQ,CAAC;IACtBD,KAAK,CAACY,cAAc,EAAE;EACxB,CAAC,CAAC;EAEFlG,SAAS,CAACmG,KAAK,EAAE;AACnB,CAAC,CAAC,C","sources":["webpack://@wp-mos/blocks/./src/blocks/formular-comanda/api.js"],"sourcesContent":["document.addEventListener(\"DOMContentLoaded\", () => {\n  const apiUrl = \"https://lasercut.internetguru.io/api/v2/analyze?id=mos\";\n\n  const orderForm = document.getElementById(\"mos-order-form\");\n  const formGroup = document.querySelector(\".order-form-group\");\n  const totalPriceElm = document.getElementById(\"order-form-total-price\");\n\n  const data = [];\n  const loader = \"...\";\n\n  let totalPrice = null;\n\n  // Init data\n  const initData = (id, group) => {\n    data[id] = {\n      group: group,\n      status: null,\n      price: null,\n      lastMod: null,\n      material: null,\n      quantity: null,\n      file: null,\n      fileHash: null,\n      fileURL: null,\n      fileWidth: null,\n      fileHeight: null,\n      productPrice: null,\n      addedGroup: false,\n      valid: false,\n    };\n  };\n\n  // Listen for form group change\n  const formGroupListener = (group, id) => {\n    group.addEventListener(\"change\", () => {\n      getResult(id);\n    });\n  };\n\n  const updateGroup = (id) => {\n    totalPrice = 0;\n    data.forEach((group) => {\n      if (group === null || group.prices === null) {\n        return;\n      }\n\n      if (id && id === group.group.getAttribute(\"data-id\")) {\n        group.status.innerHTML = loader;\n      }\n\n      const materialSelect = group.group.querySelector(\".order-form-material\");\n\n      if (materialSelect.children.length == 1) {\n        materialSelect.innerHTML = \"\";\n\n        group.prices.forEach((priceData) => {\n          const option = document.createElement(\"option\");\n          option.value = priceData.material_id;\n          option.innerHTML = `${priceData.material_name}`;\n          option.setAttribute(\"data-name\", priceData.material_name);\n          materialSelect.appendChild(option);\n        });\n      }\n\n      const quantity = group.group.querySelector(\".order-form-quantity\").value;\n      const price =\n        group.prices[materialSelect.selectedIndex].unit_price * quantity +\n        group.prices[materialSelect.selectedIndex].fix_price;\n\n      setTimeout(() => {\n        group.status.innerHTML = `${Math.round(price)} RON`;\n      }, 300);\n\n      let width = Math.round(group.fileWidth);\n      let height = Math.round(group.fileHeight);\n\n      group.group.querySelector(\n        \".order-form-dimensions\"\n      ).innerHTML = `${width} x ${height} mm`;\n\n      group.group.productPrice = price;\n      totalPrice += price;\n      group.material =\n        materialSelect[materialSelect.selectedIndex].getAttribute(\"data-name\");\n    });\n    totalPriceElm.innerHTML = `${Math.round(totalPrice)} RON`;\n  };\n\n  // Update form group\n  const getResult = (id) => {\n    const group = data[id].group;\n    const groupFile = group.querySelector(\".order-form-file\");\n    const groupMaterial = group.querySelector(\".order-form-material\");\n    const groupQuantity = group.querySelector(\".order-form-quantity\");\n    const formStatus = group.querySelector(\".order-form-status\");\n\n    // Get material & quantity values\n    const groupMaterialValue = groupMaterial.value;\n    const groupQuantityValue = groupQuantity.value;\n\n    // Get material name\n    const groupMaterialName =\n      groupMaterial.options[groupMaterial.selectedIndex].text;\n\n    // Get file\n    let file = null;\n    if (data[id].file == null) {\n      if (!groupFile.value) {\n        formStatus.innerHTML = \"No file selected.\";\n        return;\n      }\n      file = groupFile.files[0];\n    } else {\n      file = data[id].file;\n    }\n\n    // Check if quantity is valid\n    if (groupQuantityValue < 1 || groupQuantityValue > 100) {\n      formStatus.innerHTML = \"Quantity must be between 1 and 100.\";\n      return;\n    }\n\n    const fileName = file.name;\n    const lastMod = file.lastModified + fileName;\n\n    // Set quantity\n    data[id].quantity = groupQuantityValue;\n\n    if (data[id].lastMod !== lastMod) {\n      data[id].status = formStatus;\n      data[id].material = groupMaterialValue;\n      data[id].lastMod = lastMod;\n\n      const form = new FormData();\n      form.append(\"material\", groupMaterialValue);\n      form.append(\"amount\", groupQuantityValue);\n\n      if (data[id].valid && data[id].fileHash !== null) {\n        form.append(\"hash\", data[id].fileHash);\n      } else {\n        form.append(\"dxf_file\", file, fileName);\n      }\n\n      formStatus.innerHTML = loader;\n\n      fetch(apiUrl, {\n        method: \"POST\",\n        body: form,\n      })\n        .then((response) => {\n          if (response.ok) {\n            return response.json();\n          }\n          return response.json().then((text) => {\n            throw new Error(text.message);\n          });\n        })\n        .then((result) => {\n          data[id].prices = result.prices;\n          data[id].materialPrices = result.prices;\n          data[id].fileHash = result.file_hash;\n          data[id].fileURL = result.file_path;\n          data[id].fileWidth = result.model_width;\n          data[id].fileHeight = result.model_height;\n          data[id].file = file;\n          data[id].valid = true;\n          if (!data[id].group) {\n            // add new group\n            data[id].addedGroup = true;\n          }\n          updateGroup(id);\n        })\n        .catch((error) => {\n          console.log(error);\n          formStatus.innerHTML = error;\n          data[id].lastMod = null;\n          data[id].valid = false;\n        });\n      return;\n    }\n\n    data[id].material = groupMaterialValue;\n    updateGroup(id);\n    data[id].valid = true;\n  };\n\n  const init = () => {\n    initData(0, formGroup);\n    formGroupListener(formGroup, 0);\n  };\n\n  init();\n\n  // submit form\n  orderForm.addEventListener(\"submit\", (event) => {\n    const formData = new FormData(orderForm);\n\n    const request = new XMLHttpRequest();\n    request.open(\"POST\", mos_auth_rest.order, true);\n    request.onload = () => {\n      if (request.status === 200) {\n        const response = JSON.parse(request.responseText);\n        console.log(response);\n      } else {\n        console.log(\"error\");\n      }\n    };\n    request.send(formData);\n    event.preventDefault();\n  });\n\n  orderForm.reset();\n});\n"],"names":["document","addEventListener","apiUrl","orderForm","getElementById","formGroup","querySelector","totalPriceElm","data","loader","totalPrice","initData","id","group","status","price","lastMod","material","quantity","file","fileHash","fileURL","fileWidth","fileHeight","productPrice","addedGroup","valid","formGroupListener","getResult","updateGroup","forEach","prices","getAttribute","innerHTML","materialSelect","children","length","priceData","option","createElement","value","material_id","material_name","setAttribute","appendChild","selectedIndex","unit_price","fix_price","setTimeout","Math","round","width","height","groupFile","groupMaterial","groupQuantity","formStatus","groupMaterialValue","groupQuantityValue","groupMaterialName","options","text","files","fileName","name","lastModified","form","FormData","append","fetch","method","body","then","response","ok","json","Error","message","result","materialPrices","file_hash","file_path","model_width","model_height","catch","error","console","log","init","event","formData","request","XMLHttpRequest","open","mos_auth_rest","order","onload","JSON","parse","responseText","send","preventDefault","reset"],"sourceRoot":""}